```html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Cagnotte</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <style>
        :root{--primary:#4361ee;--secondary:#3a0ca3;--success:#4cc9f0;--warning:#f72585;--light:#f8f9fa;--dark:#212529;--gray:#6c757d;--border-radius:12px;--shadow:0 10px 20px rgba(0,0,0,0.1);--transition:all 0.3s ease}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',system-ui,sans-serif}
        body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);color:var(--dark);min-height:100vh;padding:20px}
        .container{max-width:1400px;margin:0 auto}
        .header{text-align:center;margin-bottom:30px;padding:20px;background:white;border-radius:var(--border-radius);box-shadow:var(--shadow)}
        .header h1{color:var(--secondary);font-size:2.5rem;margin-bottom:10px;display:flex;align-items:center;justify-content:center;gap:15px}
        .header h1 i{color:var(--warning)}
        .view{display:none;animation:fadeIn 0.5s ease}
        .view.active{display:block}
        .card{background:white;border-radius:var(--border-radius);box-shadow:var(--shadow);padding:25px;margin-bottom:25px}
        .card-title{display:flex;align-items:center;gap:10px;color:var(--secondary);margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #f0f0f0}
        .card-title i{font-size:1.3rem}
        .form-group{margin-bottom:20px}
        .form-label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark)}
        .form-control{width:100%;padding:12px 15px;border:2px solid #e1e5ee;border-radius:8px;font-size:1rem;transition:var(--transition)}
        .form-control:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(67,97,238,0.2)}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 24px;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:var(--transition)}
        .btn-primary{background-color:var(--primary);color:white}
        .btn-primary:hover{background-color:var(--secondary);transform:translateY(-2px)}
        .btn-success{background-color:var(--success);color:white}
        .btn-warning{background-color:var(--warning);color:white}
        .btn-outline{background-color:transparent;color:var(--primary);border:2px solid var(--primary)}
        .btn-outline:hover{background-color:var(--primary);color:white}
        .btn-small{padding:8px 16px;font-size:0.9rem}
        .alert{padding:15px;border-radius:8px;margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .alert-success{background-color:rgba(76,201,240,0.1);color:#0c5460;border-left:4px solid var(--success)}
        .alert-error{background-color:rgba(247,37,133,0.1);color:#721c24;border-left:4px solid var(--warning)}
        .user-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-bottom:30px}
        .user-card{background:white;border-radius:var(--border-radius);padding:20px;box-shadow:0 5px 15px rgba(0,0,0,0.05);transition:var(--transition);border:2px solid transparent}
        .user-card:hover{transform:translateY(-5px);box-shadow:var(--shadow);border-color:var(--primary)}
        .user-card.selected{border-color:var(--primary);background-color:rgba(67,97,238,0.05)}
        .user-card h3{color:var(--secondary);margin-bottom:10px;display:flex;align-items:center;gap:10px}
        .financial-summary{display:flex;justify-content:space-between;margin-top:20px;padding:15px;background:linear-gradient(135deg,#4361ee,#3a0ca3);color:white;border-radius:var(--border-radius)}
        .summary-item{text-align:center}
        .summary-value{font-size:1.8rem;font-weight:700;margin-bottom:5px}
        .summary-label{font-size:0.9rem;opacity:0.9}
        .month-selector{display:flex;align-items:center;gap:20px;margin-bottom:25px;flex-wrap:wrap}
        .month-buttons{display:flex;flex-wrap:wrap;gap:10px}
        .month-btn{padding:10px 20px;background:#f0f2f5;border:none;border-radius:8px;cursor:pointer;transition:var(--transition);font-weight:500}
        .month-btn.active{background-color:var(--primary);color:white}
        .month-btn:hover:not(.active){background-color:#e1e5ee}
        .financial-table{width:100%;border-collapse:collapse;margin-top:20px;box-shadow:0 5px 15px rgba(0,0,0,0.05);border-radius:10px;overflow:hidden}
        .financial-table th{background-color:var(--primary);color:white;padding:15px;text-align:left;font-weight:600}
        .financial-table td{padding:15px;border-bottom:1px solid #f0f0f0}
        .financial-table tr:last-child td{border-bottom:none}
        .financial-table tr:nth-child(even){background-color:#f9f9f9}
        .financial-table tr:hover{background-color:rgba(67,97,238,0.05)}
        .total-row{font-weight:700;background-color:rgba(67,97,238,0.1)!important}
        .input-group{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:20px}
        .login-container{max-width:500px;margin:50px auto}
        .login-card{text-align:center;padding:40px}
        .login-icon{font-size:3rem;color:var(--primary);margin-bottom:20px}
        .nav-bar{display:flex;justify-content:space-between;align-items:center;background:white;padding:15px 25px;border-radius:var(--border-radius);margin-bottom:30px;box-shadow:var(--shadow)}
        .user-info{display:flex;align-items:center;gap:15px}
        .user-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--secondary));display:flex;align-items:center;justify-content:center;color:white;font-weight:600}
        .logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:1.5rem;color:var(--secondary)}
        .logout-btn{display:flex;align-items:center;gap:8px}
        .page-title{font-size:1.8rem;color:var(--secondary);margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .empty-state{text-align:center;padding:50px 20px;color:var(--gray)}
        .empty-state i{font-size:3rem;margin-bottom:20px;opacity:0.5}
        .readonly-badge{background-color:var(--success);color:white;padding:5px 10px;border-radius:20px;font-size:0.8rem;display:inline-block;margin-left:10px}
        @keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        @media(max-width:768px){.header h1{font-size:1.8rem}.financial-summary{flex-direction:column;gap:15px}.input-group{grid-template-columns:1fr}.user-list{grid-template-columns:1fr}.financial-table{display:block;overflow-x:auto}}
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-bar" id="navBar" style="display:none">
            <div class="logo">
                <i class="fas fa-piggy-bank"></i>
                <span>La Cagnotte</span>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <div id="userEmail"></div>
                    <div style="font-size:0.8rem;color:var(--gray)" id="userRole"></div>
                </div>
                <button class="btn btn-outline btn-small logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Déconnexion
                </button>
            </div>
        </div>
        
        <div class="view active" id="loginView">
            <div class="login-container">
                <div class="card login-card">
                    <div class="login-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h1 style="margin-bottom:10px">La Cagnotte</h1>
                    <p style="color:var(--gray);margin-bottom:30px">Gestion financière par utilisateur</p>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="votre@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">Mot de passe</label>
                        <input type="password" id="loginPassword" class="form-control" placeholder="Votre mot de passe">
                    </div>
                    
                    <div id="loginAlert" class="alert" style="display:none"></div>
                    
                    <button class="btn btn-primary" id="loginBtn" style="width:100%;margin-top:10px">
                        <i class="fas fa-sign-in-alt"></i> Se connecter
                    </button>
                    
                    <div style="margin-top:30px;padding-top:20px;border-top:1px solid #eee;text-align:left">
                        <h3 style="margin-bottom:15px;color:var(--secondary)">Comptes de démonstration</h3>
                        <p><strong>Admin:</strong> admin@lacagnotte.com / admin123</p>
                        <p><strong>Utilisateur:</strong> user@lacagnotte.com / user123</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="view" id="adminView">
            <div class="header">
                <h1><i class="fas fa-user-cog"></i> Interface Administrateur</h1>
                <p>Gérer les utilisateurs et leurs données financières</p>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-user-plus"></i> Créer un nouvel utilisateur</h2>
                <div class="input-group">
                    <div class="form-group">
                        <label class="form-label" for="newUserEmail">Email</label>
                        <input type="email" id="newUserEmail" class="form-control" placeholder="nouvel@utilisateur.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="newUserPassword">Mot de passe</label>
                        <input type="password" id="newUserPassword" class="form-control" placeholder="Mot de passe">
                    </div>
                </div>
                <button class="btn btn-primary" id="createUserBtn">
                    <i class="fas fa-user-plus"></i> Créer l'utilisateur
                </button>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-users"></i> Utilisateurs</h2>
                <div id="usersList" class="user-list"></div>
            </div>
            
            <div id="financialSection" style="display:none">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> Données financières pour <span id="selectedUserName"></span></h2>
                    
                    <div class="month-selector">
                        <div>
                            <label class="form-label">Année:</label>
                            <select id="yearSelect" class="form-control" style="width:120px"></select>
                        </div>
                        <div>
                            <label class="form-label">Mois:</label>
                            <div class="month-buttons" id="monthButtons"></div>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <div class="form-group">
                            <label class="form-label">Chiffre d'affaire</label>
                            <input type="number" id="caInput" class="form-control" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Salaire</label>
                            <input type="number" id="salaireInput" class="form-control" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes de frais (CNDF)</label>
                            <input type="number" id="cndfInput" class="form-control" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Déductions</label>
                            <input type="number" id="deductionInput" class="form-control" placeholder="0">
                        </div>
                    </div>
                    
                    <div class="form-group" style="display:flex;gap:15px">
                        <button class="btn btn-success" id="saveDataBtn">
                            <i class="fas fa-save"></i> Enregistrer
                        </button>
                        <button class="btn btn-outline" id="clearDataBtn">
                            <i class="fas fa-eraser"></i> Effacer
                        </button>
                    </div>
                    
                    <div id="dataAlert" class="alert" style="display:none"></div>
                </div>
                
                <div class="financial-summary">
                    <div class="summary-item">
                        <div class="summary-label">Total Cagnotte</div>
                        <div class="summary-value" id="totalCagnotte">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Chiffre d'affaire total</div>
                        <div class="summary-value" id="totalCA">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total salaires</div>
                        <div class="summary-value" id="totalSalaire">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total restant</div>
                        <div class="summary-value" id="totalRestant">0 €</div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-table"></i> Tableau annuel <span id="tableYear"></span></h2>
                    <div style="overflow-x:auto">
                        <table class="financial-table" id="financialTable">
                            <thead>
                                <tr>
                                    <th>Mois</th>
                                    <th>Chiffre d'affaire</th>
                                    <th>Salaire</th>
                                    <th>CNDF</th>
                                    <th>Déductions</th>
                                    <th>Restant</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="view" id="userView">
            <div class="header">
                <h1><i class="fas fa-user"></i> Mon Espace Cagnotte</h1>
                <p>Consultez vos données financières en lecture seule</p>
                <div class="readonly-badge">Lecture seule</div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-chart-line"></i> Mes données financières</h2>
                
                <div class="month-selector">
                    <div>
                        <label class="form-label">Année:</label>
                        <select id="userYearSelect" class="form-control" style="width:120px"></select>
                    </div>
                </div>
                
                <div class="financial-summary">
                    <div class="summary-item">
                        <div class="summary-label">Ma Cagnotte</div>
                        <div class="summary-value" id="userTotalCagnotte">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Chiffre d'affaire total</div>
                        <div class="summary-value" id="userTotalCA">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total salaires</div>
                        <div class="summary-value" id="userTotalSalaire">0 €</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total restant</div>
                        <div class="summary-value" id="userTotalRestant">0 €</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title"><i class="fas fa-table"></i> Mon tableau annuel <span id="userTableYear"></span></h2>
                <div style="overflow-x:auto">
                    <table class="financial-table" id="userFinancialTable">
                        <thead>
                            <tr>
                                <th>Mois</th>
                                <th>Chiffre d'affaire</th>
                                <th>Salaire</th>
                                <th>CNDF</th>
                                <th>Déductions</th>
                                <th>Restant</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig={apiKey:"AIzaSyAXKLrIUSXZVeroPlrLCGm47_KjdKaycjE",authDomain:"invitdbs.firebaseapp.com",databaseURL:"https://invitdbs-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"invitdbs",storageBucket:"invitdbs.firebasestorage.app",messagingSenderId:"459910810884",appId:"1:459910810884:web:aa020d10de800be0385451",measurementId:"G-58FW7J6C7N"}
        firebase.initializeApp(firebaseConfig)
        const auth=firebase.auth()
        const database=firebase.database()
        let currentUser=null
        let selectedUserId=null
        let selectedUserName=null
        let selectedYear=new Date().getFullYear()
        let selectedMonth=new Date().getMonth()+1
        const months=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"]
        document.addEventListener('DOMContentLoaded',function(){
            const loginView=document.getElementById('loginView')
            const adminView=document.getElementById('adminView')
            const userView=document.getElementById('userView')
            const navBar=document.getElementById('navBar')
            const loginBtn=document.getElementById('loginBtn')
            const logoutBtn=document.getElementById('logoutBtn')
            const createUserBtn=document.getElementById('createUserBtn')
            const saveDataBtn=document.getElementById('saveDataBtn')
            const clearDataBtn=document.getElementById('clearDataBtn')
            const yearSelect=document.getElementById('yearSelect')
            const userYearSelect=document.getElementById('userYearSelect')
            const monthButtons=document.getElementById('monthButtons')
            function initYearSelectors(){
                const currentYear=new Date().getFullYear()
                const startYear=currentYear-5
                yearSelect.innerHTML=''
                for(let year=startYear;year<=currentYear+5;year++){
                    const option=document.createElement('option')
                    option.value=year
                    option.textContent=year
                    if(year===currentYear)option.selected=true
                    yearSelect.appendChild(option)
                }
                userYearSelect.innerHTML=''
                for(let year=startYear;year<=currentYear+5;year++){
                    const option=document.createElement('option')
                    option.value=year
                    option.textContent=year
                    if(year===currentYear)option.selected=true
                    userYearSelect.appendChild(option)
                }
                document.getElementById('tableYear').textContent=currentYear
                document.getElementById('userTableYear').textContent=currentYear
                selectedYear=currentYear
            }
            function initMonthButtons(){
                monthButtons.innerHTML=''
                months.forEach((month,index)=>{
                    const monthIndex=index+1
                    const button=document.createElement('button')
                    button.className='month-btn'+(monthIndex===selectedMonth?' active':'')
                    button.textContent=month
                    button.dataset.month=monthIndex
                    button.addEventListener('click',function(){
                        document.querySelectorAll('.month-btn').forEach(btn=>{
                            btn.classList.remove('active')
                        })
                        this.classList.add('active')
                        selectedMonth=parseInt(this.dataset.month)
                        loadFinancialDataForMonth()
                    })
                    monthButtons.appendChild(button)
                })
            }
            function showView(view){
                document.querySelectorAll('.view').forEach(v=>{
                    v.classList.remove('active')
                })
                view.classList.add('active')
            }
            function loginUser(){
                const email=document.getElementById('loginEmail').value
                const password=document.getElementById('loginPassword').value
                const loginAlert=document.getElementById('loginAlert')
                loginAlert.style.display='none'
                if(!email||!password){
                    showAlert(loginAlert,'Veuillez saisir un email et un mot de passe','error')
                    return
                }
                auth.signInWithEmailAndPassword(email,password).then(()=>{
                    showAlert(loginAlert,'Connexion réussie!','success')
                    document.getElementById('loginEmail').value=''
                    document.getElementById('loginPassword').value=''
                }).catch(error=>{
                    let errorMessage='Erreur de connexion'
                    if(error.code==='auth/user-not-found')errorMessage='Utilisateur non trouvé'
                    else if(error.code==='auth/wrong-password')errorMessage='Mot de passe incorrect'
                    else if(error.code==='auth/invalid-email')errorMessage='Email invalide'
                    showAlert(loginAlert,errorMessage,'error')
                })
            }
            function logoutUser(){
                auth.signOut().then(()=>{
                    selectedUserId=null
                    selectedUserName=null
                    document.getElementById('financialSection').style.display='none'
                }).catch(error=>{
                    console.error('Erreur de déconnexion:',error)
                })
            }
            function createUser(){
                const email=document.getElementById('newUserEmail').value
                const password=document.getElementById('newUserPassword').value
                if(!email||!password){
                    alert('Veuillez saisir un email et un mot de passe')
                    return
                }
                auth.createUserWithEmailAndPassword(email,password).then(userCredential=>{
                    const userId=userCredential.user.uid
                    const userData={email:email,createdAt:firebase.database.ServerValue.TIMESTAMP}
                    database.ref('users/'+userId).set(userData).then(()=>{
                        alert('Utilisateur créé avec succès!')
                        document.getElementById('newUserEmail').value=''
                        document.getElementById('newUserPassword').value=''
                        loadUsers()
                    }).catch(error=>{
                        console.error('Erreur:',error)
                        alert('Erreur lors de la création de l\'utilisateur')
                    })
                }).catch(error=>{
                    let errorMessage='Erreur'
                    if(error.code==='auth/email-already-in-use')errorMessage='Cet email est déjà utilisé'
                    else if(error.code==='auth/invalid-email')errorMessage='Email invalide'
                    else if(error.code==='auth/weak-password')errorMessage='Le mot de passe est trop faible'
                    alert(errorMessage)
                })
            }
            function loadUsers(){
                const usersList=document.getElementById('usersList')
                usersList.innerHTML='<div class="empty-state"><i class="fas fa-users"></i><p>Chargement...</p></div>'
                database.ref('users').once('value').then(snapshot=>{
                    usersList.innerHTML=''
                    if(!snapshot.exists()){
                        usersList.innerHTML='<div class="empty-state"><i class="fas fa-users"></i><p>Aucun utilisateur</p></div>'
                        return
                    }
                    const users=snapshot.val()
                    Object.keys(users).forEach(userId=>{
                        const user=users[userId]
                        const userCard=document.createElement('div')
                        userCard.className='user-card'
                        if(userId===selectedUserId)userCard.classList.add('selected')
                        userCard.innerHTML=`<h3><i class="fas fa-user"></i> ${user.email}</h3><p><strong>ID:</strong> ${userId.substring(0,8)}...</p><button class="btn btn-outline btn-small select-user-btn" style="margin-top:15px" data-userid="${userId}" data-email="${user.email}"><i class="fas fa-chart-bar"></i> Gérer</button>`
                        usersList.appendChild(userCard)
                    })
                    document.querySelectorAll('.select-user-btn').forEach(button=>{
                        button.addEventListener('click',function(){
                            selectedUserId=this.dataset.userid
                            selectedUserName=this.dataset.email
                            document.querySelectorAll('.user-card').forEach(card=>{
                                card.classList.remove('selected')
                            })
                            this.closest('.user-card').classList.add('selected')
                            document.getElementById('financialSection').style.display='block'
                            document.getElementById('selectedUserName').textContent=selectedUserName
                            loadFinancialDataForYear()
                            loadFinancialDataForMonth()
                        })
                    })
                }).catch(error=>{
                    console.error('Erreur:',error)
                    usersList.innerHTML='<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Erreur</p></div>'
                })
            }
            function loadFinancialDataForYear(){
                if(!selectedUserId)return
                const tableBody=document.getElementById('tableBody')
                tableBody.innerHTML='<tr><td colspan="7" style="text-align:center">Chargement...</td></tr>'
                database.ref(`financialData/${selectedUserId}/${selectedYear}`).once('value').then(snapshot=>{
                    tableBody.innerHTML=''
                    let totalCA=0
                    let totalSalaire=0
                    let totalCNDF=0
                    let totalDeduction=0
                    let totalRestant=0
                    for(let month=1;month<=12;month++){
                        const monthData=snapshot.val()?snapshot.val()[month]:null
                        const ca=monthData?monthData.ca||0:0
                        const salaire=monthData?monthData.salaire||0:0
                        const cndf=monthData?monthData.cndf||0:0
                        const deduction=monthData?monthData.deduction||0:0
                        const restant=ca-(salaire+cndf+deduction)
                        totalCA+=ca
                        totalSalaire+=salaire
                        totalCNDF+=cndf
                        totalDeduction+=deduction
                        totalRestant+=restant
                        const row=document.createElement('tr')
                        row.innerHTML=`<td><strong>${months[month-1]}</strong></td><td>${ca.toLocaleString('fr-FR')} €</td><td>${salaire.toLocaleString('fr-FR')} €</td><td>${cndf.toLocaleString('fr-FR')} €</td><td>${deduction.toLocaleString('fr-FR')} €</td><td><strong>${restant.toLocaleString('fr-FR')} €</strong></td><td><button class="btn btn-outline btn-small edit-month-btn" data-month="${month}"><i class="fas fa-edit"></i> Modifier</button></td>`
                        tableBody.appendChild(row)
                    }
                    const totalRow=document.createElement('tr')
                    totalRow.className='total-row'
                    totalRow.innerHTML=`<td><strong>TOTAL ${selectedYear}</strong></td><td><strong>${totalCA.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalSalaire.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalCNDF.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalDeduction.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalRestant.toLocaleString('fr-FR')} €</strong></td><td></td>`
                    tableBody.appendChild(totalRow)
                    document.getElementById('totalCA').textContent=totalCA.toLocaleString('fr-FR')+' €'
                    document.getElementById('totalSalaire').textContent=totalSalaire.toLocaleString('fr-FR')+' €'
                    document.getElementById('totalRestant').textContent=totalRestant.toLocaleString('fr-FR')+' €'
                    document.getElementById('totalCagnotte').textContent=totalRestant.toLocaleString('fr-FR')+' €'
                    document.querySelectorAll('.edit-month-btn').forEach(button=>{
                        button.addEventListener('click',function(){
                            const month=parseInt(this.dataset.month)
                            document.querySelectorAll('.month-btn').forEach(btn=>{
                                btn.classList.remove('active')
                                if(parseInt(btn.dataset.month)===month)btn.classList.add('active')
                            })
                            selectedMonth=month
                            loadFinancialDataForMonth()
                        })
                    })
                }).catch(error=>{
                    console.error('Erreur:',error)
                    tableBody.innerHTML='<tr><td colspan="7" style="text-align:center">Erreur</td></tr>'
                })
            }
            function loadFinancialDataForMonth(){
                if(!selectedUserId)return
                database.ref(`financialData/${selectedUserId}/${selectedYear}/${selectedMonth}`).once('value').then(snapshot=>{
                    const data=snapshot.val()
                    if(data){
                        document.getElementById('caInput').value=data.ca||0
                        document.getElementById('salaireInput').value=data.salaire||0
                        document.getElementById('cndfInput').value=data.cndf||0
                        document.getElementById('deductionInput').value=data.deduction||0
                    }else{
                        document.getElementById('caInput').value=0
                        document.getElementById('salaireInput').value=0
                        document.getElementById('cndfInput').value=0
                        document.getElementById('deductionInput').value=0
                    }
                }).catch(error=>{
                    console.error('Erreur:',error)
                })
            }
            function saveFinancialData(){
                if(!selectedUserId){
                    showAlert(document.getElementById('dataAlert'),'Sélectionnez un utilisateur','error')
                    return
                }
                const ca=parseFloat(document.getElementById('caInput').value)||0
                const salaire=parseFloat(document.getElementById('salaireInput').value)||0
                const cndf=parseFloat(document.getElementById('cndfInput').value)||0
                const deduction=parseFloat(document.getElementById('deductionInput').value)||0
                const data={ca:ca,salaire:salaire,cndf:cndf,deduction:deduction,updatedAt:firebase.database.ServerValue.TIMESTAMP}
                database.ref(`financialData/${selectedUserId}/${selectedYear}/${selectedMonth}`).set(data).then(()=>{
                    showAlert(document.getElementById('dataAlert'),'Données enregistrées!','success')
                    loadFinancialDataForYear()
                    if(selectedMonth===new Date().getMonth()+1)loadFinancialDataForMonth()
                }).catch(error=>{
                    console.error('Erreur:',error)
                    showAlert(document.getElementById('dataAlert'),'Erreur','error')
                })
            }
            function loadUserData(){
                if(!currentUser)return
                const userId=currentUser.uid
                const userYear=parseInt(document.getElementById('userYearSelect').value)||selectedYear
                const userTableBody=document.getElementById('userTableBody')
                userTableBody.innerHTML='<tr><td colspan="6" style="text-align:center">Chargement...</td></tr>'
                database.ref(`financialData/${userId}/${userYear}`).once('value').then(snapshot=>{
                    userTableBody.innerHTML=''
                    let totalCA=0
                    let totalSalaire=0
                    let totalCNDF=0
                    let totalDeduction=0
                    let totalRestant=0
                    for(let month=1;month<=12;month++){
                        const monthData=snapshot.val()?snapshot.val()[month]:null
                        const ca=monthData?monthData.ca||0:0
                        const salaire=monthData?monthData.salaire||0:0
                        const cndf=monthData?monthData.cndf||0:0
                        const deduction=monthData?monthData.deduction||0:0
                        const restant=ca-(salaire+cndf+deduction)
                        totalCA+=ca
                        totalSalaire+=salaire
                        totalCNDF+=cndf
                        totalDeduction+=deduction
                        totalRestant+=restant
                        const row=document.createElement('tr')
                        row.innerHTML=`<td><strong>${months[month-1]}</strong></td><td>${ca.toLocaleString('fr-FR')} €</td><td>${salaire.toLocaleString('fr-FR')} €</td><td>${cndf.toLocaleString('fr-FR')} €</td><td>${deduction.toLocaleString('fr-FR')} €</td><td><strong>${restant.toLocaleString('fr-FR')} €</strong></td>`
                        userTableBody.appendChild(row)
                    }
                    const totalRow=document.createElement('tr')
                    totalRow.className='total-row'
                    totalRow.innerHTML=`<td><strong>TOTAL ${userYear}</strong></td><td><strong>${totalCA.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalSalaire.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalCNDF.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalDeduction.toLocaleString('fr-FR')} €</strong></td><td><strong>${totalRestant.toLocaleString('fr-FR')} €</strong></td>`
                    userTableBody.appendChild(totalRow)
                    document.getElementById('userTotalCA').textContent=totalCA.toLocaleString('fr-FR')+' €'
                    document.getElementById('userTotalSalaire').textContent=totalSalaire.toLocaleString('fr-FR')+' €'
                    document.getElementById('userTotalRestant').textContent=totalRestant.toLocaleString('fr-FR')+' €'
                    document.getElementById('userTotalCagnotte').textContent=totalRestant.toLocaleString('fr-FR')+' €'
                }).catch(error=>{
                    console.error('Erreur:',error)
                    userTableBody.innerHTML='<tr><td colspan="6" style="text-align:center">Aucune donnée</td></tr>'
                })
            }
            function clearForm(){
                document.getElementById('caInput').value=''
                document.getElementById('salaireInput').value=''
                document.getElementById('cndfInput').value=''
                document.getElementById('deductionInput').value=''
                document.getElementById('dataAlert').style.display='none'
            }
            function showAlert(alertElement,message,type){
                alertElement.innerHTML=''
                alertElement.className='alert'
                const icon=document.createElement('i')
                icon.className=type==='success'?'fas fa-check-circle':'fas fa-exclamation-circle'
                const text=document.createElement('span')
                text.textContent=message
                alertElement.appendChild(icon)
                alertElement.appendChild(text)
                alertElement.classList.add(type==='success'?'alert-success':'alert-error')
                alertElement.style.display='flex'
                setTimeout(()=>{alertElement.style.display='none'},5000)
            }
            auth.onAuthStateChanged(user=>{
                currentUser=user
                if(user){
                    navBar.style.display='flex'
                    document.getElementById('userEmail').textContent=user.email
                    const isAdmin=user.email==='admin@lacagnotte.com'
                    if(isAdmin){
                        document.getElementById('userRole').textContent='Administrateur'
                        document.getElementById('userAvatar').textContent='A'
                        showView(adminView)
                        loadUsers()
                    }else{
                        document.getElementById('userRole').textContent='Utilisateur'
                        document.getElementById('userAvatar').textContent='U'
                        showView(userView)
                        loadUserData()
                    }
                    loginView.classList.remove('active')
                }else{
                    navBar.style.display='none'
                    showView(loginView)
                }
            })
            loginBtn.addEventListener('click',loginUser)
            logoutBtn.addEventListener('click',logoutUser)
            createUserBtn.addEventListener('click',createUser)
            saveDataBtn.addEventListener('click',saveFinancialData)
            clearDataBtn.addEventListener('click',clearForm)
            yearSelect.addEventListener('change',function(){
                selectedYear=parseInt(this.value)
                document.getElementById('tableYear').textContent=selectedYear
                loadFinancialDataForYear()
            })
            userYearSelect.addEventListener('change',function(){
                selectedYear=parseInt(this.value)
                document.getElementById('userTableYear').textContent=selectedYear
                loadUserData()
            })
            initYearSelectors()
            initMonthButtons()
            function createDemoAccounts(){
                auth.signInWithEmailAndPassword('admin@lacagnotte.com','admin123').then(()=>{
                    auth.signOut()
                }).catch(error=>{})
            }
            createDemoAccounts()
        })
    </script>
</body>
</html>
```